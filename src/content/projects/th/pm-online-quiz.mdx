---
title: PM Online Quiz (พอมอถามได้ตอบได้)
description: เว็บไซต์สำหรับโครงการพอมอถามได้ตอบไดั เพื่อให้นักเรียนได้ทดสอบความรู้ความสามารถทางวิชาการ ผ่านการทำแบบทดสอบประเมินความรู้
releaseDate: 2022-03-10
tags:
  - year 2564
  - website
image: /images/projects/pm-online-quiz/login.png
gitUrl: https://github.com/coolkidssatit/pm-online-quiz
rating: 5
---

import GithubEmbed from "@/components/markdown/GithubEmbed.astro";
import ResponsiveBanner from "@/components/markdown/ResponsiveBanner.astro";

โครงการพอมอถามได้ตอบได้ เป็นโครงการจากคณะกรรมการนักเรียนฝ่ายวิชาการ ประจำปีการศึกษา 2564 โดยมีวัตถุประสงค์เพื่อ

- ให้ผู้เรียนมีทักษะในการอ่าน ฟัง พูด อ่าน เขียน เพื่อค้นคว้าหาความรู้เพิ่มเติม
- ส่งเสริมความสามารถในการคิดวิเคราะห์ในการทดสอบของผู้เรียน
- เพื่อเป็นการเตรียมความพร้อมในการสอบในระดับต่างๆ

โดยดำเนินการในรูปแบบของเว็บไซต์สำหรับให้นักเรียนเข้าทำแบบทดสอบ โดยแบ่งออกเป็น 2 ระดับชั้น ดังต่อไปนี้

1. **ระดับชั้นมัธยมศึกษา** เป็นแบบทดสอบความรู้และความสามารถทั่วไป โดยแบ่งแบบทดสอบออกเป็น 3 ชุด 3 กลุ่มสาระการเรียนรู้ ได้แก่ ภาษาไทย สังคมศึกษา และภาษาต่างประเทศ กลุ่มสาระการเรียนรู้ละ 35 ข้อ
2. **ระดับชั้นมัธยมศึกษาตอนปลาย** เป็นแบบทดสอบความรู้ระดับที่รวบรวมจากแบบทดสอบเก่าที่ใช้ในการสอบเข้ามหาวิทยาลัยในช่วงหลายปีที่ผ่านมา โดยแบ่งแบบทดสอบออกเป็น 5 ชุด 5 กลุ่มสาระการเรียนรู้ ได้แก่
   - ภาษาไทย 50 ข้อ
   - สังคมศึกษา 50 ข้อ
   - คณิตศาสตร์ 30 ข้อ
   - วิทยาศาสตร์ 50 ข้อ
   - ภาษาต่างประเทศ 80 ข้อ

โครงการนี้เปิดให้นักเรียนเข้าทำแบบทดสอบตั้งแต่วันที่ 10 - 31 มีนาคม 2565 โดยผมได้มีส่วนร่วมในจัดทำโครงการนัี้ร่วมกับคณะกรรมการนักเรียน ประจำปีการศีึกษา 2564 ในส่วนของการจัดทำเว็บไซต์สำหรับสร้างและเข้าทำแบบทดสอบในโครงการ

## ที่มาของผลงาน

สืบเนื่องจากสถานการณ์การแพร่ระบาดของเชื้อไวรัส COVID-19 ทำให้ทุกโครงการของคณะกรรมการนักเรียนจำเป็นต้องจัดในรูปแบบออนไลน์ทั้งสิ้น โครงการนี้ก็เช่นเดียวกัน ผมจึงได้รับการทาบทามให้มาช่วยในการจัดทำเว็บไซต์นี้ด้วย

เมื่อพูดถึงตัวเลือกในการจัดทำแบบทดสอบออนไลน์ ตัวเลือกแรกของใครหลาย ๆ คนคือการใช้ Google Forms โดยแนวทางคือการรวมลิงก์ Google Forms และประชาสัมพันธ์ด้วยตนเอง แต่ Google Forms เป็นเว็บไซต์สำหรับการจัดทำ**แบบสอบถามหรือแบบสำรวจ** ไม่ได้ออกแบบมาสำหรับการจัดทำแบบทดสอบ

ขณะนั้นความต้องการสำหรับการจัดทำเว็บไซต์นี้มีอยู่หลายประการ อาทิเช่น

- แบบทดสอบสามารถจับเวลาในระหว่างการทำได้ (❌️ ไม่สามารถทำได้)
- แบบทดสอบสามารถแสดงผลข้อความที่ซับซ้อน เช่น สูตรคณิตศาสตร์ หรือบทความยาว ๆ ได้ (➖️ อาจสามารถทำได้ ใช้เป็นรูปภาพแทน)
- แบบทดสอบสามารถจัดทำได้ง่าย โดยไม่ใช้ Syntax ที่ยากและซับซ้อนจนเกินไป (✅️ มีส่วนติดต่อที่ใช้งานได้ง่ายและคุ้นเคย)
- แบบทดสอบสามารถสลับข้อได้ แต่ในบางชุดบางส่วนก็ไม่ต้องการให้สลับได้ เช่น ส่วนของการอ่านบทความ เป็นต้น (➖️ สลับลำดับข้อได้เฉพาะทั้งชุดแบบทดสอบ ไม่สามารถสลับเฉพาะส่วนได้)
- แบบทดสอบสามารถกลับมาทำใหม่ได้ หากเกิดปัญหาในการเชื่อมต่อ เช่น อินเทอร์เน็ตขัดข้อง เป็นต้น (➖️ สามารถทำได้หากเปิดใช้งาน Autosave แต่ผู้ใช้งานจะสามารถออกจากหน้าเว็บที่จัดทำนี้ได้)

ตัวเลือกอื่น ๆ ในการใช้งานก็เช่น การใช้งานระบบ Learning Management System (LMS) อย่าง Moodle แต่การจะติดตั้งระบบดังกล่าวจำเป็นต้องใช้เซิร์ฟเวอร์ที่มีทรัพยากรและค่าใช้จ่ายจำนวนหนึ่ง อีกทั้งบางฟีเจอร์ก็ยังไม่สามารถตอบสนองต่อความความต้องการ

ด้วยข้อจำกัดนี้เอง ผมจึงมีแนวคิดในการออกแบบระบบที่สามารถจัดทำแบบทดสอบ (Editor) และแสดงผลแบบทดสอบ (Renderer) ได้ด้วย และนำไปแสดงผลในเว็บไซต์ที่เขียนขึ้นเอง ซึ่งจะกล่าวถึงในหัวข้อถัดไป

## หลักการทำงาน

เว็บไซต์นี้จัดทำโดยใช้ภาษา TypeScript เลือกใช้ Next.js เป็น React Framework สำหรับการพัฒนา
และเผยแพร่เว็บไซต์นี้ผ่านทางแพลตฟอร์ม Vercel และ Netlify

<ResponsiveBanner />

### ระบบแบบทดสอบ

![PM Online Quiz User Exam](/images/projects/pm-online-quiz/user-exam.gif)

สำหรับระบบแบบทดสอบนั้นผมได้รับแรงบันดาลใจจาก [Perseus](https://github.com/Khan/perseus) ซึ่งเป็นระบบที่ใช้ภายในแบบฝึกหัดของเว็บไซต์ [Khan Academy](https://khanacademy.org) และเขียนด้วย JavaScript (React) โดย Khan Academy เป็นเว็บไซต์คอร์สเรียนฟรีในรายวิชาต่าง ๆ ที่เป็นภาษาอังกฤษจำนวนมาก แต่ Perseus เพิ่งจะมีการเขียนใหม่และ Open-source ในกลางปี 2565 ขณะที่กำลังเขียนเว็บไซต์นั้น Perseus ยังเป็นเวอร์ชั่นเก่า (ดูตัวอย่างจาก Fork [ที่นี่](https://github.com/lemasc/perseus)) ที่ไม่ได้รับการดูแลตั้งแต่ปี 2561 จึงยังไม่สามารถใช้งานได้ ต้องเขียนใหม่ด้วยตนเอง

อย่างไรก็ดี โครงสร้างต่าง ๆ ที่ใช้ภายใน Perseus ก็ถูกนำมาใช้เป็นแกนหลัก ๆ ของระบบแบบทดสอบนี้เช่นเดียวกัน ส่วนประกอบสำคัญที่ใช้ในการจัดทำระบบแบบทดสอบมีดังนี้

- **Markdown** เพื่อให้การจัดทำแบบทดสอบสามารถทำได้โดยใช้ภาษาที่ง่าย แต่ยังสามารถขยายส่วนเสริมต่าง ๆ ได้ตามต้องการ ผมจึงเลือกใช้ภาษา Markdown ในการพิมพ์จัดทำแบบทดสอบ และใช้ Library เสริมในการแปลง Markdown เป็น HTML เช่น [`simple-markdown`](https://github.com/ariabuckles/simple-markdown)
- [**KaTeX**](https://katex.org/) เป็น Library สำหรับแสดงผลสูตรคณิตศาสตร์บนเว็บไซต์โดยใช้คำสั่งภาษา LaTeX
- [**TOAST UI Editor**](https://ui.toast.com/tui-editor) เป็นโปรแกรมแก้ไขและแสดงผล Markdown แบบ WYSIWYG โดยสามารถในการเพิ่มเติม Plugin เพื่อใช้คำสั่งพิเศษในการปรับแต่งผลลัพธ์การแสดงผลได้
- [**Zustand**](https://github.com/pmndrs/zustand) เป็น React Library สำหรับเก็บข้อมูล (State) ซึ่งเป็นองค์ประกอบสำคัญที่ทำให้ระบบแบบทดสอบมีประสิทธิภาพสูงแม้การแสดงผลแต่ละข้อจะมีความซับซ้อนมากก็ตาม

![PM Online Quiz Admin Overview](/images/projects/pm-online-quiz/admin-overview.gif)

ผลลัพธ์ที่ได้ คือระบบแบบทดสอบแบบ Multiple Choices (MCQ) หลายตัวเลือก ที่มีประสิทธิภาพสูงตัวหนึ่ง แต่ก็ยังสามารถปรับแต่งได้ตามความต้องการ โดยมีฟีเจอร์โดดเด่นต่าง ๆ อาทิเช่น

- การแสดงผลบนอุปกรณ์เคลื่อนที่แบบ Responsive ในทุกส่วนของแบบทดสอบ
- สามารถออกแบบการตรวจแบบทดสอบได้ทั้ง Client และ Server
- การแสดงผลสูตรคณิตศาสตร์ในตัวโจทย์ของแบบทดสอบ หรีอในแต่ละตัวเลือกได้

![Editor Markdown Features](/images/projects/pm-online-quiz/editor-features.png)

- การแสดงผล Passage หรือบทความ ควบคู่ไปกับแบบทดสอบ (และสามารถเลือกให้แสดงเฉพาะข้อที่ต้องการได้) ด้วยฟังก์ชัน **Content**
- การสลับข้อทั้งแบบทดสอบ หรือเฉพาะส่วนที่ต้องการ (เช่น การเติมคำ Fill in the blanks ไม่สามารถสลับข้อได้)
- สามารถอ้างอิงเลขข้อในแบบทดสอบได้ แม้จะต้องผ่านการสุ่มสลับข้อโดยระบบอีก

_ตัวอย่างในส่วนของการแสดงผล_

![Dynamic Item - Renderer](/images/projects/pm-online-quiz/dynamic-item-renderer.gif)

_ตัวอย่างในโปรแกรมแก้ไข_

![Dynamic Item - Editor](/images/projects/pm-online-quiz/dynamic-item-editor.gif)

ความสามารถเหล่านี้เกิดขึ้นได้โดยมีหลักการพื้นฐานว่า ในแแบบทดสอบคือ **Section หลัก** ที่อาจประกอบด้วย **หลาย Section ย่อย ๆ** โดยใน Section ก็สามารถมี **หลาย ๆ ข้อ (Items)** ได้ ในแต่ละ Section (รวมถึงตัวแบบทดสองเอง) จึงสามารถกำหนดค่าต่าง ๆ ได้โดยอิสระ ไม่กระทบซึ่งกันและกัน เช่น Section นี้ไม่สามารถสุ่มลำดับข้อได้ Section นี้มี Content นี้ตลอดในทุกข้อย่อย

![Sections - Editor](/images/projects/pm-online-quiz/admin-exam-sections.gif)

### การเข้าสู่ระบบ

เว็บไซต์นี้ใช้ **Firebase Authentication** เป็นระบบตรวจสอบสิทธิ์ผู้ใช้งาน โดยตั้งค่าให้สามารถเข้าสู่ระบบโดยใช้บัญชี Google ของโรงเรียน (G Suite For Education) ดังรูป

![PM Online Quiz - Login](/images/projects/pm-online-quiz/login.png)

### การเข้าทำแบบทดสอบ

![PM Online Quiz - Home](/images/projects/pm-online-quiz/home.png)

เมื่อเข้าสู่ระบบแล้ว ระบบจะแสดงข้อมูลแบบทดสอบ ดังนี้

- **แบบทดสอบที่สามารถทำได้** แบ่งตามระดับชั้น สถานะ (ยังไม่ได้เข้าสอบ หรือ กำลังสอบอยู่) และระยะเวลาในการสอน (ถ้ามี)
- **ประวัติการทำแบบทดสอบ** แสดงคะแนนที่ได้ และวันที่และเวลาที่ส่งแบบทดสอบ

เมื่อคลิกที่แบบทดสอบที่สามารถเข้าสอบได้ ระบบจะแสดงคำชี้แจงก่อนเข้าทำแบบทดสอบ ดังรูป

![PM Online Quiz - Exam Instructions](/images/projects/pm-online-quiz/instructions.png)

เมื่อคลิกที่ปุ่ม **เริ่มทำแบบทดสอบ** ระบบจะถือว่าเป็นการเริ่มต้น **Session** ในการทำแบบทดสอบ โดยมีเงื่อนไขดังต่อไปนี้

- Session การทำแบบทดสอบ จะสิ้นสุดก็ต่อเมื่อผู้ใช้งานกดส่งแบบทดสอบ หรือหมดเวลาการทำแบบทดสอบ
- Session จะยังคงอยู่หากออกจากเว็บไซต์ หรือปิดเบราว์เซอร์ปัจจุบัน
- ในการ Login 1 ครั้ง สามารถทำแบบทดสอบกี่ชุดก็ได้ ตราบใดที่ Session ในแต่ละแบบทดสอบยังไม่สิ้นสุด
- Session ไม่สามารถโอนข้ามเบราวเซอร์หรืออุปกรณ์ได้ (เปิดเครื่องอื่นจะเสมือนเริ่มทำแบบมทดสอบใหม่)

ในส่วนนี้มีความท้าทายทาง Technical หลายอย่าง สามารถอธิบายได้ดังนี้

#### การบันทึกข้อมูลในระหว่างการทำแบบทดสอบ

การทำงานของเว็บไซต์บนแพลตฟอร์ม Serverless อย่าง Vercel นั้น ระบบจะไม่มีเซิร์ฟเวอร์เป็นของตนเอง แต่ในคำขอที่จำเป็นต้องใช้เซิร์ฟเวอร์ในการประมวลผลแต่ละครั้ง (เช่น API Routes) ระบบจะเรียกใช้คำสั่งขนาดเล็กที่เขียนขึ้นเรียกว่า Lambda เพื่อมาประมวลผล จากนั้นเมื่อเสร็จสิ้น Lambda จะถูกหยุดและปิดใช้งานลงไป แต่ละ Lambda จะมีระยะเวลาการประมวลผลที่สั้นและรวดเร็ว จึงไม่มีการเก็บข้อมูลภายใน Lambda หรือพูดง่าย ๆ ก็คือ ข้อมูลใด ๆ ที่ประมวลผลจะอยู่เฉพาะใน Lambda ที่ประมวลผลอยู่เท่านั้น เมื่อเสร็จสิ้นข้อมูลก็จะหายไป

ในแต่ละการทดสอบ จำเป็นต้องมีการตรวจสอบสถานะของผู้ใช้อย่างต่อเนื่อง ว่าผู้ใช้ที่กำลังเข้าสอบนี้เป็นผู้ใช้รายเดียวกันหรือไม่ เริ่มเข้าสอบเมื่อไหร่ และสิ้นสุดการสอบเมื่อไหร่ ข้อมูลเหล่านี้มีการเรียกใช้ถี่มาก ๆ หากจะเก็บข้อมูลลงในฐานข้อมูลจากบริการภายนอกอย่าง Firebase Firestore ก็มีใช้โควต้าการใช้งานที่สูง เนื่องจาก Firestore คิดค่าบริการเป็นต่อ 1 คำขอ

ตัวเลือกในขณะนั้นคือการเก็บข้อมูลลงใน Cookie ของผู้ใช้ โดยการเข้ารหัสด้วย Library อย่าง [**Iron Session**](https://github.com/vvo/iron-session) ซึ่งเป็น Library สำหรับการจัดเก็บข้อมูลและเข้ารหัสลงใน Cookies ทำให้สามารถอ่าน-บันทึกข้อมูลจากเว็บไซต์มายังผู้ใช้ได้โดยไม่จำเป็นต้องมีเซิร์ฟเวอร์ (Stateless) โดยจุดอ่อนของวิธีการนี้มี 2 ข้อ

- ผู้ใช้งานสามารถปิดใช้งานหรือลบคุกกี้เพื่อล้างสถานะทั้ังหมดได้
- คุกกี้มีความยาวที่จำกัด ดังนั้นสามารถจัดเก็บข้อมูลได้จำกัด

แม้จะมีจุดอ่อน 2 ข้อ แต่เนื่องจากสามารถตอบโจทย์การเรียกดูและเขียนข้อมูลโดย Lambda ได้รวดเร็วและไม่จำกัดจำนวนครั้ง

> ปัจจุบันขณะที่เขียนหน้านี้ Solution ทางเลือกในการเก็บข้อมูลจากฝั่ง Serverless คือการใช้ฐานข้อมูลแบบ Key-Value
> อย่าง Redis หรือ Cloudflare KV ซึ่ง Redis มีผู้ให้บริการที่เป็น Serverless อย่าง [Upstash Redis](https://upstash.com/) ด้วย
>
> ผมได้นำไปประยุกต์ใช้กับผลงานต่อไปอย่าง [PM Station](/projects/pm-station) ในการจัดเก็บข้อมูล Token

#### การเริ่มต้น (Start) Session การทำแบบทดสอบ

ในการเริ่มต้นทำแบบทดสอบแต่ละครั้ง สิ่งที่เกิดขึ้นหลัก ๆ คือการสุ่มลำดับข้อในแบบทดสอบ โดยจะต้องบันทึกข้อมูลทั้งหมดลงใน 1 Session ให้ได้

หากเป็นระบบทั่วไปก็สามารถใช้ฟังก์ชันในการสลับลำดับของ Array ได้เลย แต่เนื่องจากแบบทดสอบมีหลาย Section ย่อย ๆ จึงมีความจำเป็นต้องใช้คำสั่งแบบ Recursive Function ที่จะประมวลผลเป็นขั้นบันได กล่าวคือ แบบทดสอบหลัก (Main Section) จะประมวลผล Section ย่อย ๆ ไปเรื่อย ๆ จนกว่าจะไม่มี Section ใด ๆ เหลืออยู่

ในการประมวลผลโดยระบบ 1 ข้อที่สมบูรณ์ จะเรียกว่า **1 Hash Item** ซึ่งจะมีโครงสร้างดังต่อไปนี้

<div class="max-w-full">
<div class="flex flex-row items-center bg-gray-100 p-4 rounded-lg overflow-x-auto">
  <span class="font-medium flex-shrink-0 rounded-2xl px-6 py-2 bg-red-200 text-red-800">
    Main Section
  </span>
  <span class="text-2xl px-2">~</span>
  <span class="font-medium flex-shrink-0 rounded-2xl px-6 py-2 bg-green-200 text-green-800">
    Section A (ถ้ามี)
  </span>
  <span class="text-2xl px-2">~</span>
  <span class="font-medium flex-shrink-0 rounded-2xl px-6 py-2 bg-green-200 text-green-800">
    Section B (ถ้ามี)
  </span>
  <span class="text-2xl px-2">~</span>

  <span class="font-medium flex-shrink-0 rounded-2xl px-6 py-2 bg-blue-200 text-blue-800">
    เลขข้อ (A-Z)
  </span>
</div>
</div>

ยกตัวอย่างเช่น หากข้อสอบมี ID ว่า `EXAM` และมี Section ย่อย A ที่มี ID เป็น `GRAMMAR` จะสามารถได้ Hash Item ของข้อที่ 1 คือ `EXAM~GRAMMAR~A` เป็นต้น

แต่ในสถานการณ์จริงเนื่องจากข้อมูลถูกบันทึกไว้ใน Firestore Firebase จึงได้ ID ที่มีความยาวตัวอักษรมาก เช่น `rabViBBh3ExNw7rwElUXA`

ดังนั้น เพื่อประหยัดพื้นที่การจัดเก็บข้อมูล จึงมีการสร้าง Hash ของ ID ที่มีความยาวสั้นกว่า และเก็บไว้เป็นข้อมูลกลาง เสมือนเป็นชื่อเล่น ดังนั้น แทนที่จะเรียก ID จาก Firestore ที่ยาวมาก ๆ เราก็ใช้ Hash ที่มีความยาวสั้นกว่าแทน จาก ID

ผมเลือกใช้ Library ที่ชื่อ [nanoid](https://github.com/ai/nanoid) ในการ Generate Hash โดยเลือกความยาวที่ไม่ยาวจนเกินไป แต่ก็ไม่สั้นจนเกินไปจนมีโอกาสได้ค่าที่ซ้ำกัน

<GithubEmbed
  file="https://github.com/coolkidssatit/pm-online-quiz/blob/main/pages/api/exam/%5Bid%5D/start.ts"
  startLine={39}
  endLine={44}
/>

เมื่อได้ Hash Item ของ Section ที่กำลังประมวลผลอยู่ในขณะนั้น ก็สามารถสลับลำดับข้อได้เลย

<GithubEmbed
  file="https://github.com/coolkidssatit/pm-online-quiz/blob/main/pages/api/exam/%5Bid%5D/start.ts"
  startLine={12}
  endLine={24}
/>

จากนั้นจึงค่อยแยกประมวลผล Section ย่อย ๆ ไม่สามารถสลับลำดับข้อในขั้นตอนสุดท้ายได้ เพราะมีความเป็นไปได้ว่า Section ย่อยที่ไม่ต้องการให้ถูกสลับข้อนั้นจะถูกสลับไปด้วย (สามารถพิสูจน์ได้ด้วยกฏการสลับที่ทั่วไป)

ตารางของค่า Hash และ Firebase Document ID จะถูกเก็บเข้ารหัสไว้ใน Session Cookie รวมถึงข้อมูลอื่น ๆ เช่น เวลาเริ่มต้นและสิ้นสุดการทำแบบทดสอบด้วย

<GithubEmbed
  file="https://github.com/coolkidssatit/pm-online-quiz/blob/main/pages/api/exam/%5Bid%5D/start.ts"
  startLine={98}
  endLine={112}
/>

ส่วนข้อมูลที่สามารถส่งกลับไปยังผู้ใช้งานได้คือ

- ลำดับข้อของแบบทดสอบ (ซึ่งเป็น Hash Item จึงเสมือนว่า Obfuscate มาแล้วชั้นหนึ่ง)
- ลำดับข้อของข้อสอบที่จำเป็นต้องเรียกดู Content (เนื้อหาหรือบทความ)
- ชื่อของ Section ในแบบทดสอบที่ต้องแสดงผลแก่ผู้ใช้งาน

<GithubEmbed
  file="https://github.com/coolkidssatit/pm-online-quiz/blob/main/pages/api/exam/%5Bid%5D/start.ts"
  startLine={127}
  endLine={132}
/>

### การกู้คิืน (Restore) Session การทำแบบทดสอบ

### การเรียกดูโจทย์ (Data) / เนื้อหาและบทความ (Content)
